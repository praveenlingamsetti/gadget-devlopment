{"version":3,"sources":["/var/gadget/codegen/framework-1729659914536-oIXGhE/src/Session.ts"],"sourcesContent":["/**\n * Bag of key-values associated with the current actor running this request or action\n **/\nexport class Session {\n  static fromInput(input?: Record<string, any>): Session | undefined {\n    if (input) {\n      return new Session(input.id, input);\n    }\n  }\n\n  changedKeys: Set<string> = new Set<string>();\n  ended = false;\n  touched = false;\n  #storage: Record<string, any>;\n\n  constructor(private _id: string | null, obj: Record<string, any>) {\n    this.#storage = obj;\n  }\n\n  get(key: string): any {\n    return this.#storage[key];\n  }\n\n  set(key: string, value: any): void {\n    this.changedKeys.add(key);\n    this.#storage[key] = value;\n  }\n\n  touch(): void {\n    this.touched = true;\n  }\n\n  delete(key: string): void {\n    this.changedKeys.add(key);\n    this.#storage[key] = null;\n  }\n\n  end(): void {\n    this.changedKeys.add(\"id\");\n    this.ended = true;\n  }\n\n  clearChanges(): void {\n    this.changedKeys.clear();\n  }\n\n  get changed(): boolean {\n    return this.changedKeys.size > 0;\n  }\n\n  toJSON(): Record<string, any> {\n    return this.#storage;\n  }\n\n  toChangedJSON(): Record<string, any> {\n    const changes: Record<string, any> = {};\n    for (const key of this.changedKeys) {\n      changes[key] = this.#storage[key];\n    }\n    return changes;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  set id(value: string | null) {\n    this._id = value;\n    this.set(\"id\", this._id);\n  }\n}\n"],"names":["Session","fromInput","input","id","get","key","set","value","changedKeys","add","touch","touched","delete","end","ended","clearChanges","clear","changed","size","toJSON","toChangedJSON","changes","_id","constructor","obj","Set"],"mappings":";;;;+BAGaA;;;eAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAUX;AAbF;;EAEE,GACK,MAAMA;IACX,OAAOC,UAAUC,KAA2B,EAAuB;QACjE,IAAIA,OAAO;YACT,OAAO,IAAIF,QAAQE,MAAMC,EAAE,EAAED;QAC/B;IACF;IAWAE,IAAIC,GAAW,EAAO;QACpB,OAAO,yBAAA,IAAI,EAAC,SAAQ,CAACA,IAAI;IAC3B;IAEAC,IAAID,GAAW,EAAEE,KAAU,EAAQ;QACjC,IAAI,CAACC,WAAW,CAACC,GAAG,CAACJ;QACrB,yBAAA,IAAI,EAAC,SAAQ,CAACA,IAAI,GAAGE;IACvB;IAEAG,QAAc;QACZ,IAAI,CAACC,OAAO,GAAG;IACjB;IAEAC,OAAOP,GAAW,EAAQ;QACxB,IAAI,CAACG,WAAW,CAACC,GAAG,CAACJ;QACrB,yBAAA,IAAI,EAAC,SAAQ,CAACA,IAAI,GAAG;IACvB;IAEAQ,MAAY;QACV,IAAI,CAACL,WAAW,CAACC,GAAG,CAAC;QACrB,IAAI,CAACK,KAAK,GAAG;IACf;IAEAC,eAAqB;QACnB,IAAI,CAACP,WAAW,CAACQ,KAAK;IACxB;IAEA,IAAIC,UAAmB;QACrB,OAAO,IAAI,CAACT,WAAW,CAACU,IAAI,GAAG;IACjC;IAEAC,SAA8B;QAC5B,gCAAO,IAAI,EAAC;IACd;IAEAC,gBAAqC;QACnC,MAAMC,UAA+B,CAAC;QACtC,KAAK,MAAMhB,OAAO,IAAI,CAACG,WAAW,CAAE;YAClCa,OAAO,CAAChB,IAAI,GAAG,yBAAA,IAAI,EAAC,SAAQ,CAACA,IAAI;QACnC;QACA,OAAOgB;IACT;IAEA,IAAIlB,KAAK;QACP,OAAO,IAAI,CAACmB,GAAG;IACjB;IAEA,IAAInB,GAAGI,KAAoB,EAAE;QAC3B,IAAI,CAACe,GAAG,GAAGf;QACX,IAAI,CAACD,GAAG,CAAC,MAAM,IAAI,CAACgB,GAAG;IACzB;IAtDAC,YAAY,AAAQD,GAAkB,EAAEE,GAAwB,CAAE;;QALlEhB,uBAAAA,eAAAA,KAAAA;QACAM,uBAAAA,SAAAA,KAAAA;QACAH,uBAAAA,WAAAA,KAAAA;QACA,gCAAA;;mBAAA,KAAA;;aAEoBW,MAAAA;aALpBd,cAA2B,IAAIiB;aAC/BX,QAAQ;aACRH,UAAU;uCAIH,UAAWa;IAClB;AAqDF"}